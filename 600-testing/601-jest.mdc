---
id: 601
title: Jest 测试最佳实践
description: Jest 单元测试和集成测试的最佳实践
globs: ["**/*.test.js", "**/*.test.ts", "**/*.spec.js", "**/*.spec.ts", "__tests__/**/*"]
priority: medium
tags: [jest, testing, unit-test, integration-test, tdd]
version: 1.0.0
author: Turbo AI Rules
lastUpdated: 2025-11-20
---

# Jest 测试最佳实践

## 适用场景

- Jest 单元测试、React 组件测试、API 端点测试

## 核心内容

AAA 模式（Arrange-Act-Assert）、Mock 隔离依赖、async/await 异步测试、React Testing Library。

## 关键原则

- ✅ 一测试一功能点
- ✅ 描述性测试名称
- ✅ AAA 模式（Arrange-Act-Assert）
- ✅ 测试公共接口非实现
- ✅ Mock 隔离外部依赖

## 关键决策点

### 1. AAA 模式

```javascript
describe("User", () => {
  it("should create user with valid data", () => {
    // Arrange
    const userData = { name: "John", email: "john@example.com" };
    
    // Act
    const user = new User(userData);
    
    // Assert
    expect(user.name).toBe("John");
  });
});
```

### 2. Mock 和 Spy

```javascript
// Mock 函数
const mockFn = jest.fn();
mockFn.mockReturnValue(42);
mockFn.mockResolvedValue("async value");

expect(mockFn).toHaveBeenCalled();
expect(mockFn).toHaveBeenCalledWith("arg1", "arg2");

// Mock 模块
jest.mock("./user-service");
UserService.getUser.mockResolvedValue({ id: 1 });

// Spy
const spy = jest.spyOn(object, "method");
spy.mockReturnValue("mocked");
```

### 3. 异步测试

```javascript
// async/await
it("should fetch user data", async () => {
  const user = await fetchUser(1);
  expect(user.name).toBe("John");
});

// 测试 reject
it("should reject with error", async () => {
  await expect(fetchUser(-1)).rejects.toThrow("User not found");
});
```

### 4. React 组件测试

```javascript
import { render, screen, fireEvent } from "@testing-library/react";
import userEvent from "@testing-library/user-event";

it("should call onClick when clicked", async () => {
  const handleClick = jest.fn();
  render(<Button onClick={handleClick}>Click</Button>);
  
  await userEvent.click(screen.getByRole("button"));
  expect(handleClick).toHaveBeenCalledTimes(1);
});
```

### 5. 测试覆盖率配置

```javascript
// jest.config.js
module.exports = {
  collectCoverageFrom: ["src/**/*.{js,ts}", "!src/**/*.test.{js,ts}"],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
    },
  },
};
```

## 项目特定配置

```json
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage"
  }
}
```

## 常见问题

**Q: 如何测试 Private 方法？**
A: 不直接测试,通过公共接口间接测试。

**Q: Mock vs Spy？**
A: Mock 替换实现,Spy 监视并可选替换。

## 扩展阅读

- [Jest 官方文档](https://jestjs.io/)
- [Testing Library](https://testing-library.com/)
