# 故障报告

**故障 ID**: INC-2026-XXXX  
**级别**: P0 / P1 / P2 / P3 / P4  
**报告人**: @XXX  
**创建时间**: 2026-01-23 14:32

---

## 摘要

简短描述故障现象和影响（1-2句话）

---

## 影响范围

- **受影响用户数**: 约 10万 / 所有用户 / 特定地区
- **影响时长**: 38分钟（14:32 - 15:10）
- **业务影响**: 用户无法登录，订单无法提交
- **财务影响**: 预计损失 XX 元（可选）

---

## 时间线

| 时间  | 事件                         | 操作人 |
| ----- | ---------------------------- | ------ |
| 14:30 | 发布 v2.4.0 到生产环境       | @部署  |
| 14:32 | 告警触发：登录接口 5xx > 50% | 自动   |
| 14:35 | 确认故障，启动应急响应       | @张三  |
| 14:40 | 尝试重启服务，未解决         | @张三  |
| 14:45 | 决定回滚到 v2.3.1            | @IC    |
| 14:50 | 回滚完成，部分用户恢复       | @运维  |
| 15:00 | 清理异常数据                 | @DBA   |
| 15:10 | 所有服务恢复正常，解除告警   | @张三  |

---

## 根因分析

### 直接原因

v2.4.0 版本中数据库连接池配置错误，maxConnections 从 100 误改为 10，导致高并发时连接耗尽。

### 根本原因（5 Whys）

1. **为什么服务不可用？** → 数据库连接超时
2. **为什么连接超时？** → 连接池只有10个连接，瞬间耗尽
3. **为什么配置错误？** → 配置文件合并时误删了一个 '0'
4. **为什么没发现？** → 缺少配置 Review 流程，未进行压力测试
5. **为什么流程缺失？** → 团队快速扩张，新人未接受培训

**根因**: 缺少配置变更 Review 流程 + 未进行生产级压测

---

## 解决方案

### 临时方案（已执行）

- ✅ 回滚到 v2.3.1
- ✅ 手动修复配置文件
- ✅ 清理异常连接

### 永久修复

- 🔄 添加配置变更 Review 流程
- 🔄 在 CI 中增加配置验证步骤
- 🔄 增加压力测试覆盖

---

## Action Items

| 任务                            | 负责人 | 截止日期   | 状态 |
| ------------------------------- | ------ | ---------- | ---- |
| 建立配置变更 Review 流程        | @张三  | 2026-01-25 | 🔄   |
| 添加 CI 配置验证（JSON Schema） | @李四  | 2026-01-26 | 🔄   |
| 编写压力测试脚本                | @王五  | 2026-01-30 | 🔄   |
| 更新部署文档                    | @张三  | 2026-01-24 | 🔄   |
| 组织应急演练培训                | @经理  | 2026-02-05 | 🔄   |

---

## 经验教训

### 做得好的地方 ✅

- 快速发现和响应（2分钟内）
- 决策果断（15分钟内决定回滚）
- 沟通及时透明
- 保留了完整的操作记录

### 需要改进的地方 ⚠️

- 配置变更未经 Review
- 缺少生产级压测
- 金丝雀发布未启用
- 监控覆盖不足（未监控连接池使用率）

---

## 附录

### 相关链接

- Grafana 监控: https://grafana.company.com/...
- 错误日志: https://sentry.io/...
- Git Commit: https://github.com/company/repo/commit/abc123

### 关键配置变更

```diff
- maxConnections: 10
+ maxConnections: 100
```
